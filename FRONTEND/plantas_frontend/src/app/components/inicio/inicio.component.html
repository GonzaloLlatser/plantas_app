<div class="container-fluid inicio-background flex ">
  <div class="row justify-content mt-5">
    <div class="col col-md-2 col-sm-12">
      <!-- Opciones del Perfil -->
      <div class="flex-column menuOpcionesCuenta">
        <button
          type="button"
          class="btn btn-outline-secondary d-flex align-items-center gap-1 w-100"
          data-bs-toggle="modal"
          data-bs-target="#actualizarDatosModal">
          <fa-icon [icon]="faUser"></fa-icon>
          <span>Cuenta</span>
        </button>
        <!-- BotÃ³n Cerrar sesiÃ³n -->
        <button
          type="button"
          class="btn btn-outline-secondary d-flex align-items-center gap-1 mt-1 w-100"
        >
          <fa-icon [icon]="faRightFromBracket"></fa-icon>

          <span>SesiÃ³n</span>
        </button>

        <!-- BotÃ³n Eliminar cuenta -->
        <button
          type="button"
          class="btn btn-outline-secondary d-flex align-items-center gap-1 mt-1 w-100"
          data-bs-toggle="modal"
          data-bs-target="#eliminarCuentaModal"
        >
          <fa-icon [icon]="faTrashAlt"></fa-icon>
          <span>Borrar cuenta</span>
        </button>

      </div>
    </div>

    @defer (when plantas) {
      @if (plantas.length === 0) {
        <div class="col col-md-9 col-sm-6 justify-content-center align-items-center flex-column formularioCSS_clase">
          <p class="textContenedor">AÃºn no has agregado tus plantas. No lo dejes para mÃ¡s tarde y ponte a ello.</p>
          <div class="text-center mt-2">
            <img
              [src]="'/images/plantaLogoApp.png'"
              [alt]="'Icono principal'"
              class="card-img-bottom w-25">
          </div>
          <div class="text-center mt-2">
            <a [routerLink]="['/planta/nueva/'+id_usuario]" class="btn botonCSS btn-sm">Â¿Nueva planta?</a>
          </div>
        </div>
      } @else {
        <div class="col col-md-9 col-sm-6 justify-content-center align-items-center flex-column ">
          <div class="row d-flex justify-content-center mt-2">
            @for (planta of plantas; track $index) {
              <div class="col col-md-3 mb-4">
                <div class="card shadow-lg border-0 rounded-4 bg-light-subtle">
                  <!-- Header con nombre -->
                  <div class="card-header text-center text-white rounded-top-4">
                    <h5 class="card-title m-0 fw-bold">{{ planta.nombre }}</h5>
                  </div>

                  <!-- Imagen -->
                  <div class="text-center mt-3">
                    <img
                      [src]="'/images/img_default.png'"
                      [alt]="'Imagen de ' + planta.nombre"
                      class="rounded-circle border border-3 border-success-subtle shadow-sm"
                      style="width: 120px; height: 120px; object-fit: cover;">
                  </div>

                  <!-- Cuerpo con info -->
                  <div class="card-body px-4 py-3">
                    <p class="card-text mb-1"><strong>ğŸŒ¿ Tipo:</strong> {{ planta.tipoPlanta }}</p>
                    <p class="card-text mb-1"><strong>ğŸ“ UbicaciÃ³n:</strong> {{ planta.ubicacion | slice:0:20 }} ...</p>
                    <p class="card-text mb-1"><strong>ğŸ—“ï¸ Adquirida:</strong> {{ planta.fechaAdquisicion.day }}
                      /{{ planta.fechaAdquisicion.month }}/{{ planta.fechaAdquisicion.year }}</p>
                    <p class="card-text mb-1"><strong>ğŸ’§ Ãšltimo riego:</strong> {{ planta.fechaUltimoRiego.day }}
                      /{{ planta.fechaUltimoRiego.month }}/{{ planta.fechaUltimoRiego.year }}</p>
                    <p class="card-text mb-1"><strong>âœ‚ï¸ Ãšltima poda:</strong> {{ planta.fechaPoda.day }}
                      /{{ planta.fechaPoda.month }}/{{ planta.fechaPoda.year }}</p>
                    <p class="card-text mb-1"><strong>ğŸš¿ PrÃ³ximo riego:</strong> {{ planta.fechaProximoRiego.day }}
                      /{{ planta.fechaProximoRiego.month }}/{{ planta.fechaProximoRiego.year }}</p>
                    <!-- Notas con truncado y tooltip -->
                    <p class="card-text text-dark fst-italic mb-1" [title]="planta.notas">
                      <strong>ğŸ“ Notas:</strong> {{ planta.notas | slice:0:10 }} ...
                    </p>
                    <hr>
                    <p class="card-text mb-1"><strong>ğŸ“Œ Recordatorios:</strong></p>
                    <!-- EnseÃ±a el icono dependiendo de los dÃ­as restantes -->
                    <p class="card-text mb-1"
                       [ngClass]="{'text-danger': calcularDiasRestantes(planta.fechaProximoRiego) <= 3}">
                      <span *ngIf="calcularDiasRestantes(planta.fechaProximoRiego) <= 0">ğŸ’§ Â¡Es hora de regar!</span>
                      <span
                        *ngIf="calcularDiasRestantes(planta.fechaProximoRiego) > 0 && calcularDiasRestantes(planta.fechaProximoRiego) <= 3">âš  Â¡Falta poco para el riego!</span>
                      <!-- <span *ngIf="calcularDiasRestantes(planta.fechaProximoRiego) > 3">ğŸŸ¢ El riego aÃºn falta.</span>-->
                    </p>
                    <p class="card-text mt-2"
                       [ngClass]="{'text-danger': calcularDiasDesdeUltimaPoda(planta.fechaPoda) >= 30}">
                      <span *ngIf="calcularDiasDesdeUltimaPoda(planta.fechaPoda) >= 30">âœ‚ï¸ Â¡Ya pasÃ³ un mes desde la Ãºltima poda!</span>
                      <span *ngIf="calcularDiasDesdeUltimaPoda(planta.fechaPoda) >= 15 && calcularDiasDesdeUltimaPoda(planta.fechaPoda) < 30">ğŸ•’ Hace poco mÃ¡s de dos semanas</span>
                      <span *ngIf="calcularDiasDesdeUltimaPoda(planta.fechaPoda) < 15">âœ… Poda reciente</span>
                    </p>

                  </div>

                  <!-- Footer con acciÃ³n -->
                  <div class="card-footer text-center bg-white border-top-0 pb-3">
                    <a [routerLink]="['/planta/editar', planta.id, id_usuario]"
                       class="btn btn-sm rounded px-4 card-footer-btn">
                      Detalles
                    </a>
                  </div>
                </div>
              </div>
            }
          </div>
          <div class="text-center mt-2">
            <a [routerLink]="['/planta/nueva/'+id_usuario]" class="btn botonCSS btn-sm">Â¿Nueva planta?</a>
          </div>
        </div>
      }
    } @placeholder () {
      <div class="d-flex justify-content-center mt-5"></div>
    }

    <!-- Modal -->
    <div class="modal fade" [attr.id]="'actualizarDatosModal'"
         tabindex="-1"
         aria-labelledby="actualizarDatosModalLabel"
         aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content modalEstilos shadow-lg border-0 rounded-4">

          <!-- Header -->
          <div class="modal-header bg-primary text-white rounded-top">
            <h1 class="modal-title fs-4 fw-bold" id="actualizarDatosModalLabel">
              âœï¸ Â¡Hora de actualizar tus datos!
            </h1>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                    aria-label="Cerrar"></button>
          </div>

          <!-- Body -->
          <div class="modal-body px-5 py-4">
            <form [formGroup]="formUserEdit" (ngSubmit)="actualizarCuenta()">
              <!-- Nombre -->
              <div class="form-floating mb-4">
                <input type="text" formControlName="nombre" class="form-control" id="nombre" placeholder="Nombre">
                <label for="nombre">ğŸ‘¤ Nombre</label>
                <!-- Validaciones -->
                @if (nombre.invalid && (nombre.dirty || nombre.touched)) {
                  @if (nombre.errors?.['required']) {
                    <div class="alert alert-danger mt-2">Â¡Debes indicar un nombre!</div>
                  }
                  @if (nombre.errors?.['maxlength']) {
                    <div class="alert alert-warning mt-2">Â¡No superes los 50 caracteres!</div>
                  }
                  @if (nombre.errors?.['minlength']) {
                    <div class="alert alert-warning mt-2">Â¡Escribe tu nombre completo!</div>
                  }
                  @if (nombre.errors?.['nombre']) {
                    <div class="alert alert-warning mt-2">Â¿EstÃ¡s seguro? Eso no parece un nombre.</div>
                  }
                  @if (nombre.errors?.['notOnlyWhiteSpace']) {
                    <div class="alert alert-danger mt-2">Â¿Solo espacios? Dale, ponÃ© tu nombre ğŸ˜…</div>
                  }
                }
              </div>

              <!-- Email -->
              <div class="form-floating mb-4">
                <input type="email" formControlName="email" class="form-control" id="email" placeholder="Email">
                <label for="email">ğŸ“§ Email</label>
                @if (email.invalid && (email.dirty || email.touched)) {
                  @if (email.errors?.['required']) {
                    <div class="alert alert-danger mt-2">Â¡Debes indicar un email!</div>
                  }
                  @if (email.errors?.['maxlength']) {
                    <div class="alert alert-warning mt-2">Â¡No superes los 50 caracteres!</div>
                  }
                  @if (email.errors?.['minlength']) {
                    <div class="alert alert-warning mt-2">Â¡Escribe tu correo completo!</div>
                  }
                  @if (email.errors?.['email']) {
                    <div class="alert alert-warning mt-2">Â¿EstÃ¡s seguro? Eso no parece un correo.</div>
                  }
                  @if (email.errors?.['notOnlyWhiteSpace']) {
                    <div class="alert alert-danger mt-2">Â¿Solo espacios? No parece vÃ¡lido.</div>
                  }
                }
              </div>

              <!-- Password -->
              <div class="form-floating mb-4">
                <input type="password" formControlName="password" class="form-control" id="password"
                       placeholder="ContraseÃ±a">
                <label for="password">ğŸ”’ ContraseÃ±a</label>
                @if (password.invalid && (password.dirty || password.touched)) {
                  @if (password.errors?.['required']) {
                    <div class="alert alert-danger mt-2">Â¡Debes indicar una contraseÃ±a!</div>
                  }
                  @if (password.errors?.['minlength']) {
                    <div class="alert alert-warning mt-2">Â¡Debe tener al menos 8 caracteres!</div>
                  }
                  @if (password.errors?.['maxlength']) {
                    <div class="alert alert-warning mt-2">Â¡No superes los 20 caracteres!</div>
                  }
                  @if (password.errors?.['notOnlyWhiteSpace']) {
                    <div class="alert alert-danger mt-2">Â¿Solo espacios? Â¡Eso no sirve como contraseÃ±a!</div>
                  }
                }
              </div>

              <!-- BotÃ³n Guardar -->
              <div class="text-end">
                <button type="submit" class="btn btn-success px-4 but">
                  ğŸ’¾ Guardar cambios
                </button>
              </div>
            </form>
          </div>

          <!-- Footer -->
          <div class="modal-footer bg-light rounded-bottom d-flex justify-content-between">
            <small class="text-muted">Puedes cerrar sin guardar si cambiaste de opiniÃ³n ğŸ˜Œ</small>
            <button type="button" class="btn btn-outline-secondary px-4" data-bs-dismiss="modal">
              Cancelar
            </button>
          </div>

        </div>
      </div>
    </div>
    <!--Finaliza Modal-->

    <!-- Modal -->
    <div class="modal fade" [attr.id]="'eliminarCuentaModal'"
         tabindex="-1"
         aria-labelledby="deleteModalLabel"
         aria-hidden="true">
      <div class="modal-dialog ">
        <div class="modal-content modalEstilos shadow-lg border-0 rounded-4">
          <div class="modal-header bg-danger bg-gradient text-white rounded-top">
            <h1 class="modal-title fs-4 fw-bold">
              âš ï¸ Â¡Cuidado! Esta acciÃ³n eliminarÃ¡ tu cuenta permanentemente
            </h1>
          </div>
          <div class="modal-body text-center">
            <p class="fs-5 text-dark-emphasis">
              Â¿EstÃ¡s seguro? <br>
              Â¿QuiÃ©n cuidarÃ¡ de tus plantas?
            </p>
            <h6 class="text-danger fw-semibold mt-3">
              Si deseas continuar, haz click en <span class="text-decoration-underline">Aceptar</span>.
            </h6>
          </div>
          <div class="modal-footer d-flex justify-content-between bg-light rounded-bottom">
            <button type="button" class="btn btn-outline-secondary px-4" data-bs-dismiss="modal">
              âŒ Cancelar
            </button>
            <button type="button" class="btn btn-danger px-4" data-bs-dismiss="modal"
                    (click)="eliminarUsuario(usuario.id)">
              ğŸ—‘ï¸ Aceptar
            </button>
          </div>
        </div>
      </div>
    </div>
    <!--Finaliza Modal-->
  </div>
</div>
